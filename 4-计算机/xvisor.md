orphan vcpu 是不属于任何 guest 的 vcpu，xvisor 创建 orphan vcpu 来运行后台进程和管理守护进程。

xvisor 中正常的 vcpu 运行在 user mode，orphan vcpu 运行在 supervisor mode。

```
+--------------------------+                  +--------------------------+
|          Guest_0         |                  |          Guest_N         |
+--------------------------+                  +--------------------------+
| +--------+    +--------+ |                  | +--------+    +--------+ |
| |        |    |        | |                  | |        |    |        | |
| | VCPU_0 | .. | VCPU_M | |                  | | VCPU_0 | .. | VCPU_K | |
| |        |    |        | |                  | |        |    |        | |
| +--------+    +--------+ | ................ | +--------+    +--------+ |
+--------------------------+                  +--------------------------+
|       Address Space      |                  |       Address Space      |
|+--------+ +-----+ +-----+|                  |+--------+ +-----+ +-----+|
|| Memory | | PIC | | PIT ||                  || Memory | | PIC | | PIT ||
|+--------+ +-----+ +-----+|                  |+--------+ +-----+ +-----+|
| +-----+ +------+ +-----+ |                  | +-----+ +------+ +-----+ |
| | ROM | | UART | | LCD | |                  | | ROM | | UART | | LCD | |
| +-----+ +------+ +-----+ |                  | +-----+ +------+ +-----+ |
+--------------------------+                  +--------------------------+
+------------------------------------------------------------------------+
|                                                                        |
|                 eXtensible Versatile hypervISOR (Xvisor)               |
|                                                                        |
|  +----------------+  +----------+  +----------------+  +------------+  |
|  |     Guest      |  |  Command |  |  Virtualized   |  | Management |  |
|  |     Device     |  |  Manager |  |      I/O       |  |  Daemons   |  |
|  |   Emulators    |  +----------+  |   Frameworks   |  +------------+  |
|  +----------------+                +----------------+                  |
|                                                                        |
|  +---------------+  +------------+  +---------------+  +------------+  |
|  |  Hypervisor   |  | Hypervisor |  |   Hypervisor  |  | Hypervisor |  |
|  | Configuration |  |   Manager  |  | Load Balancer |  | Scheduler  |  |
|  +---------------+  +------------+  +---------------+  +------------+  |
|                                                                        |
|  +----------------+  +----------------+  +----------+  +------------+  |
|  |    Storage     |  |    Network     |  | Standard |  | Hypervisor |  |
|  | Virtualization |  | Virtualization |  |    I/O   |  |   Timer    |  |
|  +----------------+  +----------------+  +----------+  +------------+  |
|                                                         +-----------+  |
|                                                        +-----------+|  |
|  +---------------+  +--------------+  +------------+  +-----------+||  |
|  |     Misc      |  |     Host     |  |    Host    |  |  Orphan   |||  |
|  |    Driver     |  |    Device    |  |   Memory   |  |   VCPUs   ||+  |
|  |   Frameworks  |  |    Drivers   |  | Management |  | (Threads) |+   |
|  +---------------+  +--------------+  +------------+  +-----------+    |
|                                                                        |
+------------------------------------------------------------------------+
+------------------------------------------------------------------------+
|                                                                        |
|            Host Machine (Host CPU + Host Memory + Host Devices)        |
|                                                                        |
+------------------------------------------------------------------------+
```

Symmetric multiprocessing(SMP): https://en.wikipedia.org/wiki/Symmetric_multiprocessing

Asymmetric multiprocessing (AMP): [Asymmetric multiprocessing - Wikipedia](https://en.wikipedia.org/wiki/Asymmetric_multiprocessing)

Xvisor 提供了在用于构建系统的多个操作系统之间对处理核心、内存和设备进行分区或虚拟化的技术。

xvisor 的时钟系统参考了 linux hrtimer subsystem

vcpu 状态转移：

```
                                           +---------+
                               [Reset]     |         |      [Halt]
                           +---------------|  HALTED |<-----------------+
                           |               |         |                  |
                           |               +---------+                  |
                           |                    A                       |
                           |                    | [Halt]                |
                           V                    |                       |
+---------+ [Create]  +---------+  [Kick]  +---------+ [Scheduler] +---------+
|         |---------->|         |--------->|         |------------>|         |
| UNKNOWN |           |  RESET  |          |  READY  |             | RUNNING |
|         |<----------|         |<---------|         |<------------|         |
+---------+ [Destroy] +---------+  [Reset] +---------+ [Scheduler] +---------+
                        A     A              A     |                 |     |
                        |     |     [Resume] |     | [Pause]         |     |
                        |     |              |     V                 |     |
                        |     |            +---------+               |     |
                        |     |            |         |               |     |
                        |     +------------|  PAUSED |<--------------+     |
                        |        [Reset]   |         |   [Pause]           |
                        |                  +---------+                     |
                        |                                                  |
                        +--------------------------------------------------+
                                             [Reset]
```

虚拟机的地址可以是：真实物理地址、虚拟地址、其它虚拟机的地址

hypervisor 可以代替 vcpu 运行(Normal context)